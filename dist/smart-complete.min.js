/*!
 * smart-complete - 为input和textarea提供提示补全功能的AngularJS指令
 * @version 2.0.4
 * @link https://github.com/zskymn/smart-complete#readme
 */
!function(t,e){"function"==typeof define&&define.amd?define(["jquery","angular"],e):"object"==typeof module&&module.exports?module.exports=e(require("jquery"),require("angular")):e(t.jQuery,t.angular)}(this,function(t,e){e.module("smart-complete",[]),e.module("smart-complete").service("$scUtil",["$timeout","$q",function(t,e){function n(e,n){var o=null;return 0===n||n||(n=300),function(){var i=this,r=arguments;return t.cancel(o),o=t(function(){return e.apply(i,r)},n)}}function o(){return e.when([])}var i=this;i.debounce=n,i.noopSearchFunc=o}]),e.module("smart-complete").directive("smartComplete",["$parse","$scUtil","$timeout",function(n,o,i){return{restrict:"A",link:function(r,s,c){function u(){if(g=s[0].tagName.toLowerCase(),b=n(c.smartComplete),k=n(c.scSep),w=n(c.scTrim||"true"),y=n(c.scWidth),C=n(c.scHeight),j=n(c.scItemClickCb),x=n(c.scEnterCb),$="current-selected","input"!==g&&"textarea"!==g)throw"tagName must be input or textarea";T=t('<ul class="smart-complete"></ul>'),s.after(T),a(),f()}function l(e){return w(r)?t.trim(e):e}function a(){s.css("font-size",s.css("font-size")),"textarea"===g&&s.css({overflow:"auto",overflowX:"auto",overflowY:"auto",wordBreak:"break-all"}),T.hide()}function f(){s.off("click.sc").on("click.sc",v).off("keyup.sc").on("keyup.sc",o.debounce(function(t){var e=t.which;13!==e&&38!==e&&40!==e&&9!==e&&v()})).off("keydown.sc").on("keydown.sc",function(t){var n,o=t.which;if(13===o)return T.is(":visible")&&(t.preventDefault(),T.hide()),void i(function(){(x(r)||e.noop)(l(s.val()))});if(9===o)return void(T.is(":visible")&&T.hide());if(38===o)n=!0;else{if(40!==o)return;n=!1}t.preventDefault(),d(n)}),T.off("mouseenter.sc").on("mouseenter.sc","li",function(){t(this).addClass($)}).off("mouseleave.sc").on("mouseleave.sc","li",function(){T.children().removeClass($)}).off("click.sc").on("click.sc","li",function(){m(t(this).attr("value"));var n=t(this).attr("value");i(function(){(j(r)||e.noop)(n,s.val())}),T.hide()}),t(document).on("click.sc",function(){T.hide()})}function p(){var t=s.caret("pos"),e=k(r);if(!e)return s.val();e+="";var n=s.val();return n.substring(0,t).split(e).pop()+n.substring(t).split(e)[0]}function h(){var t,e,n,o=y(r),i=parseInt(C(r),10)||240,c=k(r),u=s.position(),l=s.outerWidth(),a=s.outerHeight(),f=s.caret("pos"),p=s.caret("position"),h=s.val();return c?(c+="",t=s.caret("position",f-h.substring(0,f).split(c).pop().length)):(t=s.caret("position",0),t.left=0),"100%"===o?(o=s.outerWidth(),e=0):(o=parseInt(o,10)||240,e=o>=l?0:t.left+o>=l?l-o:t.left),"input"===g?n=a:(n=p.top+p.height-s.scrollTop(),p.top>t.top&&(e=0)),{width:o,maxHeight:i,left:u.left+parseInt(s.css("marginLeft"),10)+e,top:u.top+parseInt(s.css("marginTop"),10)+n+2}}function v(){var n=p();(b(r)||o.noopSearchFunc)(l(n)).then(function(n){return t.map(n,function(t){return e.isObject(t)?t:{label:t,value:t}})},function(){return[]}).then(function(e){return 0===e.length?void T.html("").hide():void T.html(t.map(e,function(t){return'<li value="'+t.value+'">'+t.label+"</li>"}).join("")).css(h()).show()})}function d(t){if(!T.is(":hidden")){var e=T.children();if(0!==e.length){var n=e.filter("."+$).first(),o=n;if(n.length)if(t){var i=n.prev();i.length&&(o=i)}else{var r=n.next();r.length&&(o=r)}else o=t?e.last():e.first();e.removeClass($),o.addClass($),m(o.attr("value"));var s=o.position().top,c=0,u=T.height()-o.height();return s>u&&T.scrollTop(T.scrollTop()+s-u),s<c?T.scrollTop(T.scrollTop()+s-c):void 0}}}function m(t){var e,n,o,i,c,u,l=k(r);return l?(l+="",n=s.caret("pos"),c=s.val(),e=c.substring(0,n),u=e.split(l),i=u.pop(),u.push(t),c.substring(n)&&(o=c.substring(n).split(l),o.shift(),o.join(l)&&u.push(o.join(l))),s.val(u.join(l)).caret("pos",n+t.length-i.length),void s.focus().trigger("change")):void s.val(t).focus().trigger("change")}var g,b,k,w,y,C,j,x,T,$;u()}}}])});